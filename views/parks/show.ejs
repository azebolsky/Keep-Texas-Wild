<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link href="https://fonts.googleapis.com/css?family=Squada+One&display=swap" rel="stylesheet">
    <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script defer src="/javascripts/script.js"></script>
    <title>Park Details</title>
</head>
<body>
    <header class="header">
        <nav id="parks-nav">
          <h3><%= park.parkName %></h3>
          <a href="/parks">All Parks</a>
          <a href="/logout">Logout</a>
        </nav>
    </header>
    <section>
        <h3>Park Details</h3> 
            <img src="<%= park.image %>" alt="<%= park.parkName %>" width="300px" height="200px">
            <div>Lake: </div>
            <% if (park.hasLake === true) { %>
                <div><%= 'yes' %></div>
            <% } %> 
            <div>Amount of Trails: </div>
            <div><%= park.numTrails %></div>
            <div>Primitive Camping: </div>
            <% if (park.hasPrimitiveCamping === true) { %>
                <div><%= 'yes' %></div>
            <% } %> 
            <div>See below reviews:</div>
    </section>
    <form action="/parks/<%= park._id %>/reviews" method="POST">
        <label>Add Review: </label>
        <input type="text" name="content">
        <label>Rating:</label>
        <select name="rating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <input type="submit" value="Add Review">
    </form>
    <% if (park.reviews.length) { %>
        <table>
            <thead>
                <tr>
                    <th>Created At</th>
                    <th>Created By</th>
                    <th>Rating</th>
                    <th>Review</th>
                </tr>
            </thead>
            <tbody class="body-edit">
                <% let count = 0 %>
                <% park.reviews.forEach(function(p, idx) { %>
                    <% count+=p.rating %> 
                    <tr>
                    <td> </td>
                    <td> <%= p.createdAt.toLocaleDateString() %> </td>
                    <td> <%= p.createdBy.name %> </td>
                    <td> <%= p.rating %> </td>
                    <td> <%= p.content %> </td>
                        <td>
                            <form class="edit-form" data-set="<%= idx %>" action="/reviews/<%= p._id %>?_method=PUT" method="POST">
                                <select name="rating" value="<%= p.rating %>">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                                <input type="text" name="content" value="<%= p.content %> ">
                                <input type="submit" value="Submit Change">
                            </form>
                            <button data-set="<%= idx %>" class="edit-submit" type="submit">Update Review</button>
                        </td>
                        <td><form action="/reviews/<%= p._id %>?_method=DELETE" method="POST">
                            <button type="submit">Delete Review</button>
                        </form></td>
                    </tr>
                    <% }); %>
                    <td><%= (count / park.reviews.length).toFixed(1) %></td>
                </tbody>
        </table>
    <% } else { %>
        <h4>No Reviews Submitted Yet</h4>
    <% } %> 
</body>
</html>